#designed to be run locally on first boot/configuration of a new Cisco Nexus Switch
---
- name: Nexus Device Management Features
  hosts: newNexus
  gather_facts: no
  vars_file:
    - ./vars/nexusSecurity.yml
    - ./vars/nexusConfig.yml

  tasks:
    - name: Set correct hostname
      nxos_config:
        lines:
          - "hostname {{ properHostname }}"

    - name: Enable desired features
      nxos_feature:
        feature: "{{ item }}"
        state: enabled
      loop: "{{ goodFeatures }}"

    - name: Remove unncessary/unsecure features
      nxos_feature:
        feature: "{{ item }}"
        state: disabled
      loop: "{{ badFeatures }}"

    - name: FIPS mode, Password Strength, and Failed Login Blocking
      nxos_config:
        lines:
          - fips mode enable
          - password strength-check
          - login block-for 900 attempts 3 within 180

    - name: Configure Enable Password
      nxos_config:
        lines:
          - "enable secret {{ enableSecret }}"

    - name: Setup Login Banner
      nxos_banner:
        banner: motd
        text: "{{ lookup('file', './vars/companyBanner.cfg', errors='ignore') }}"
        state: present

#ntp

#set timezone

#logging server(s)

#logging - lower level to 6 and create logfile w/ manually specified size

#VTY session limiting

#VTY/console timeout after X minutes of inactivity

#VTY ACL

- name: Nexus Switch Functionality
  hosts: newNexus
  gather_facts: no


#VLANs [ including blackhole and native ]

#igmp snooping - all VLANs

#Access Ports
  #unknown unicast flood blocking (UUFB)
  #STP loopguard, rootguard, BPDUguard
  #storm-control broadcast/unicast

#Trunks

#unused ports - shutdown/blackhole vlan
